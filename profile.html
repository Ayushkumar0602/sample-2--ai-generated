<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f4;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      width: 80%;
      max-width: 600px;
      padding: 20px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      margin-top: 20px;
    }

    h1 {
      text-align: center;
      color: #333;
    }

    label {
      display: block;
      margin-bottom: 5px;
      color: #555;
    }

    input[type="text"],
    textarea {
      width: 100%;
      padding: 8px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    button {
      background-color: #007bff;
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-right: 10px;
    }

    button:hover {
      background-color: #0056b3;
    }

    .button-container {
      text-align: center;
      margin-top: 20px;
    }

    a {
      color: #007bff;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    @media (max-width: 768px) {
      .container {
        width: 95%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Profile</h1>
    <form id="profileForm">
      <label for="name">Name:</label>
      <input type="text" id="name" name="name">

      <label for="email">Email:</label>
      <input type="text" id="email" name="email" readonly>

      <label for="bio">Bio:</label>
      <textarea id="bio" name="bio" rows="4"></textarea>

      <div class="button-container">
        <button type="button" onclick="saveProfile()">Save</button>
        <button type="button" onclick="goBack()">Back to Dashboard</button>
        <button type="button" onclick="signOut()">Sign Out</button>
      </div>
    </form>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      "authDomain": "study2-7bdc7.firebaseapp.com",
      "appId": "1:320617984870:web:04b61ea4ee88ae057e4ea7",
      "apiKey": "AIzaSyCVYdfql5aqHrChlA1v3nxRLkIbYyWMvUg",
      "messagingSenderId": "320617984870",
      "projectId": "study2-7bdc7",
      "storageBucket": "study2-7bdc7.firebasestorage.app"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.firestore();

    // Check authentication status
    auth.onAuthStateChanged(user => {
      if (!user) {
        // Redirect to login page if not authenticated
        window.location.href = 'index.html';
      } else {
        // Load user data
        loadUserData(user.uid);
      }
    });

    // Load user data from Firestore
    function loadUserData(userId) {
      db.collection('users').doc(userId).get()
        .then(doc => {
          if (doc.exists) {
            const userData = doc.data();
            document.getElementById('name').value = userData.name || '';
            document.getElementById('email').value = userData.email || '';
            document.getElementById('bio').value = userData.bio || '';
          } else {
            alert('User data not found.');
          }
        })
        .catch(error => {
          console.error('Error loading user data:', error);
          alert('Error loading user data. Please try again.');
        });
    }

    // Save profile data to Firestore
    function saveProfile() {
      const user = auth.currentUser;
      if (!user) {
        alert('User not authenticated.');
        return;
      }

      const name = document.getElementById('name').value;
      const bio = document.getElementById('bio').value;

      db.collection('users').doc(user.uid).update({
        name: name,
        bio: bio
      })
        .then(() => {
          alert('Profile updated successfully!');
        })
        .catch(error => {
          console.error('Error updating profile:', error);
          alert('Error updating profile. Please try again.');
        });
    }

    // Sign out function
    function signOut() {
      auth.signOut()
        .then(() => {
          // Redirect to login page after sign out
          window.location.href = 'index.html';
        })
        .catch(error => {
          console.error('Sign out error:', error);
          alert('Error signing out. Please try again.');
        });
    }

    // Go back to dashboard
    function goBack() {
        window.location.href = 'dashboard.html';
    }
  </script>
</body>
</html>